@inject SPTDataCacheService SPTDataCacheService

<MudCard Outlined="true" Class="overflow-y-auto pa-4 ma-2">
    <MudCardHeader><MudText Typo="Typo.h4">AttributeInfo</MudText></MudCardHeader>
    
    <MudStack Row="true" AlignItems="AlignItems.Center">
        <MudTooltip Text="AttributeInfo.Weight">
            <MudNumericField @bind-Value="AttributeInfo.Weight" Label="质量"
                             HelperText="新物品的质量" Variant="Variant.Filled" Min="@double.MinValue" Max="@double.MaxValue" Clearable="true"/>
        </MudTooltip>
        
        <MudTooltip Text="AttributeInfo.Width">
            <MudNumericField @bind-Value="AttributeInfo.Width" Label="宽度"
                             HelperText="新物品的宽度" Variant="Variant.Filled" Min="1" Max="@int.MaxValue" Clearable="true"/>
        </MudTooltip>
        
        <MudTooltip Text="AttributeInfo.Height">
            <MudNumericField @bind-Value="AttributeInfo.Height" Label="高度"
                             HelperText="新物品的高度" Variant="Variant.Filled" Min="1" Max="@int.MaxValue" Clearable="true"/>
        </MudTooltip>
        
        
        <MudTooltip Text="AttributeInfo.DiscardLimit">
            <MudNumericField @bind-Value="AttributeInfo.DiscardLimit" Label="丢弃限制"
                             HelperText="丢弃限制, 常见-1, 0, 1, 2" Variant="Variant.Filled" 
                             Min="@double.MinValue" Max="@double.MaxValue" Clearable="true"/>
        </MudTooltip>
    </MudStack>
    
    <MudStack Row="true" AlignItems="AlignItems.Center">
        <MudTooltip Text="AttributeInfo.RarityPvE">
            <MudSelect T="string" @bind-Value="AttributeInfo.RarityPvE" Variant="Variant.Filled" Clearable="true" Label="RarityPvE*" HelperText="物品稀有度">
                @foreach (string rarity in ItemRarityData.RarityMapping.Keys)
                {
                <MudSelectItem Value="@rarity">@rarity</MudSelectItem>
                }
            </MudSelect>
        </MudTooltip>
        
        <MudTooltip Text="AttributeInfo.ItemSound">
            <MudSelect T="string" @bind-Value="AttributeInfo.ItemSound" Clearable="true" Variant="Variant.Filled" Label="物品声音" HelperText="物品声音">
                @foreach (string itemSound in ItemSoundData.AllowCnKeys)
                {
                    <MudSelectItem Value="@itemSound">@itemSound</MudSelectItem>
                }
            </MudSelect>
        </MudTooltip>
        
        <MudTooltip Text="AttributeInfo.BackgroundColor">
            <MudSelect T="string" @bind-Value="AttributeInfo.BackgroundColor" Clearable="true" Style="min-width: 20ch" Variant="Variant.Filled" Label="物品背景颜色" HelperText="物品背景颜色">
                @foreach (string backgroundColor in SPTDataCacheService.BackgroundColorCache!)
                {
                    <MudSelectItem Value="@backgroundColor">@backgroundColor</MudSelectItem>
                }
            </MudSelect>
        </MudTooltip>
    </MudStack>
    
    <MudStack Row="true" AlignItems="AlignItems.Center">
        <MudTooltip Text="AttributeInfo.StackMaxSize">
            <MudNumericField @bind-Value="AttributeInfo.StackMaxSize" Label="最大堆叠数"
                             HelperText="最大堆叠数" Variant="Variant.Filled" Min="1" Max="@int.MaxValue" Clearable="true"/>
        </MudTooltip>
        
        <MudTooltip Text="AttributeInfo.ExamineTime">
            <MudNumericField @bind-Value="AttributeInfo.ExamineTime" Label="检视时间"
                             HelperText="double类型, 单位为秒" Variant="Variant.Filled" Min="0" Max="@double.MaxValue" Clearable="true"/>
        </MudTooltip>
        
        <MudTooltip Text="AttributeInfo.LootExperience">
            <MudNumericField @bind-Value="AttributeInfo.LootExperience" Label="战利品经验值"
                             HelperText="战利品经验值, 正整数" Variant="Variant.Filled" Min="0" Max="@int.MaxValue" Clearable="true"/>
        </MudTooltip>
        
        <MudTooltip Text="AttributeInfo.ExamineExperience">
            <MudNumericField @bind-Value="AttributeInfo.ExamineExperience" Label="检视经验值"
                             HelperText="检视经验值, 正整数" Variant="Variant.Filled" Min="0" Max="@int.MaxValue" Clearable="true"/>
        </MudTooltip>
    </MudStack>
    
    <MudStack Row="true" AlignItems="AlignItems.Center">
        <MudTooltip Text="BaseInfo.ExaminedByDefault">
            <MudSwitch Color="Color.Warning" @bind-Value="AttributeInfo.ExaminedByDefault">是否默认已检视</MudSwitch>
        </MudTooltip>
        
        <MudSwitch Color="Color.Warning" @bind-Value="InheritanceCloneRarityPvE">继承克隆物品的RarityPvE</MudSwitch>
        
        <MudSwitch Color="Color.Warning" @bind-Value="InheritanceCloneDiscardLimit">继承克隆物品的丢弃限制</MudSwitch>
        
        <MudSwitch Color="Color.Warning" @bind-Value="InheritanceCloneItemSound">继承克隆物品的物品声音</MudSwitch>
    </MudStack>
    
    
    <MudButton OnClick="@(() => OnCheckCallback())">检查数据</MudButton>
</MudCard>

@code {
    /// <summary> 外部AttributeInfo实例 </summary>
    [Parameter] public required AttributeInfo AttributeInfo { get; set; }
    private bool InheritanceCloneRarityPvE { get; set; }
    private bool InheritanceCloneDiscardLimit { get; set; }
    private bool InheritanceCloneItemSound { get; set; }
    
    
    
    protected override void OnInitialized()
    {
        base.OnInitialized();
        AttributeInfo.ItemSound ??= "通用声音";
        AttributeInfo.RarityPvE ??= "普通";
        AttributeInfo.ExaminedByDefault ??= true;
    }

    private Task OnCheckCallback()
    {
        if (InheritanceCloneRarityPvE) AttributeInfo.RarityPvE = null;
        if (InheritanceCloneDiscardLimit) AttributeInfo.DiscardLimit = null;
        if (InheritanceCloneItemSound) AttributeInfo.ItemSound = null;
        
        return Task.CompletedTask;
    }

}